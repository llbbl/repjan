# SPDX-FileCopyrightText: 2026 Logan Lindquist Land
# SPDX-License-Identifier: FSL-1.1-MIT

name: Auto Tag

on:
  push:
    branches:
      - main

permissions:
  contents: write

jobs:
  tag:
    name: Create Version Tag
    runs-on: ubuntu-latest
    # Only run if the commit message doesn't already indicate a release
    if: "!startsWith(github.event.head_commit.message, 'chore(release):')"

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Bump version and push tag
        id: tag
        uses: mathieudutour/github-tag-action@v6.2
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          default_bump: patch
          tag_prefix: ""
          release_branches: main
          custom_release_rules: |
            feat:minor:Features,
            fix:patch:Bug Fixes,
            docs:patch:Documentation,
            style:patch:Styling,
            refactor:patch:Refactoring,
            perf:patch:Performance,
            test:patch:Testing,
            chore:patch:Chores,
            ci:patch:CI/CD,
            deps:patch:Dependencies

      - name: Summary
        env:
          PREV_TAG: ${{ steps.tag.outputs.previous_tag }}
          NEW_TAG: ${{ steps.tag.outputs.new_tag }}
          RELEASE_TYPE: ${{ steps.tag.outputs.release_type }}
        run: |
          echo "### Version Bump Summary" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "- **Previous version:** $PREV_TAG" >> $GITHUB_STEP_SUMMARY
          echo "- **New version:** $NEW_TAG" >> $GITHUB_STEP_SUMMARY
          echo "- **Bump type:** $RELEASE_TYPE" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "Release workflow will now build and publish binaries." >> $GITHUB_STEP_SUMMARY
